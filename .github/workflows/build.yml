name: Build Unity Windows

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  build:
    name: Build Unity on Self-Hosted
    runs-on: self-hosted

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true

      - name: Cache Library folder
        uses: actions/cache@v3
        with:
          path: Library
          key: Library-${{ runner.os }}-${{ hashFiles('**/Packages/manifest.json') }}
          restore-keys: |
            Library-${{ runner.os }}-

      - name: Build Unity project
        run: |
          "C:\Program Files\Unity\Hub\Editor\6000.2.9f1\Editor\Unity.exe" ^
            -batchmode ^
            -nographics ^
            -quit ^
            -projectPath "${{ github.workspace }}" ^
            -executeMethod BuildScript.BuildGame ^
            -logFile build_log.txt

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Windows-Build
          path: Builds/
